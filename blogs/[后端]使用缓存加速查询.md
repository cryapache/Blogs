---
title: 使用缓存加速查询
tags:
  - Java
  - SpringBoot
  - Redis
draft: "false"
---

# 使用缓存加速查询

在后端进行查询时需要频繁操作数据库，但数据库查询操作效率较低，压力很大。那么这时候就可以考虑将数据存在Redis中，需要时直接从Redis中获取，效率更高。

### CRUD流程变动

使用Redis查询就需要修改相应的操作，再查询时先访问Redis进行查询，如果没有得到结果则沿用从数据库查询的逻辑，而后再将数据缓存到Redis。

但这又带来一个问题，增删改的操作都在数据库中进行。如果数据库中的数据发生变动，而用户从缓存中获取的数据还是保持原样，显然是不行的，所以增删改在操作前也需要增加缓存上的操作。

### SpringBoot中使用注解提高开发效率

需要的依赖：

```xml
<!-- 缓存框架 -->
<dependency>
	<groupId>org.springframework.boot</groupid>
	<artificatId>spring-boot-starter-cache</artificatId>
</dependency>

<!-- 缓存中间件，以redis为例 -->
<dependency>
	<groupId>org.springframework.boot</groupid>
	<artificatId>spring-boot-starter-data-redis</artificatId>
</dependency>

<!-- 数据库和相关操作的依赖 -->
```

#### 常用注解

- `@EnableCaching`

  加在启动类，开启缓存注解

- `@CachePut(cacheNames = "", key = "")`

  加在Controller中的接口方法上

  最终存储到Redis的key为`cacheNames + key`

  注意key的取值可以用SpEL定义为

  - `#传进方法的参数名`          注意对应关系
  - `#p0`、`#pn`等          传进来的第n+1个参数           
  - `#result`          返回值

- `@Cacheable(cacheNames = "", key = "")`

  加在Controller中的接口方法上

  在方法执行前先查询缓存中是否有数据，如果有数据直接返回查询结果。没有的话再调用方法并将返回值放到缓存中。

- `@CacheEvict(cacheNames = "", key = "")`/`@CacheEvict(cacheNames = "", allEntries = "true")`

  加在Controller中的接口方法上

  按key清理缓存数据 / 清除cacheNames下所有数据